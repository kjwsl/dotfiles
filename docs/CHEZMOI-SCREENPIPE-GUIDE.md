# ===========================================================================
# CHEZMOI INTEGRATION GUIDE FOR SCREENPIPE
# ===========================================================================

## STRATEGY: Single Cross-Platform Script

Instead of maintaining two versions (PowerShell + Bash), use ONE Bash script
that works everywhere:
- Linux: Native bash
- macOS: Native bash  
- Windows: Git Bash / WSL / MSYS2

## CHEZMOI DIRECTORY STRUCTURE

`
~/.local/share/chezmoi/
├── .chezmoi.toml.tmpl           # Config with OS detection
├── dot_config/
│   └── screenpipe/
│       └── config.toml.tmpl     # Screenpipe config template
└── scripts/
    ├── run_once_install-screenpipe.sh.tmpl
    └── start-screenpipe.sh.tmpl
`

## FILE 1: .chezmoi.toml.tmpl

`	oml
{{- $osID := .chezmoi.os -}}
{{- $isWindows := eq $osID "windows" -}}
{{- $isLinux := eq $osID "linux" -}}
{{- $isMacOS := eq $osID "darwin" -}}

[data]
    os = "{{ $osID }}"
    isWindows = {{ $isWindows }}
    isLinux = {{ $isLinux }}
    isMacOS = {{ $isMacOS }}
    
    # Screenpipe settings
    screenpipe_fps = "0.02"
    screenpipe_capture_mode = "external-monitors-only"
`

## FILE 2: scripts/start-screenpipe.sh.tmpl

`ash
#!/usr/bin/env bash
# Auto-generated by chezmoi
# OS: {{ .chezmoi.os }}

PREFERRED_FPS="{{ .screenpipe_fps }}"
CAPTURE_MODE="{{ .screenpipe_capture_mode }}"

# [Copy the entire adaptive script content here]
`

## FILE 3: dot_config/screenpipe/config.toml.tmpl

`	oml
# Screenpipe configuration
# OS: {{ .chezmoi.os }}

fps = {{ .screenpipe_fps }}
capture_mode = "{{ .screenpipe_capture_mode }}"

{{- if .isWindows }}
data_dir = "{{ $env:LOCALAPPDATA }}\\.screenpipe"
{{- else }}
data_dir = "~/.screenpipe"
{{- end }}
`

## ADVANTAGES OF THIS APPROACH:

1. **Single source of truth**: One bash script, templated for all OSes
2. **OS-specific paths**: Chezmoi handles with templates
3. **Easy to maintain**: Edit once, works everywhere
4. **Portable**: Copy .chezmoi.toml and scripts folder anywhere
5. **Version controlled**: Everything in git

## ALTERNATIVE: Pure Chezmoi Templating

If you want even MORE control, you can template the ENTIRE script:

`ash
#!/usr/bin/env bash
{{- if .isWindows }}
SCREENPIPE_PATH="$LOCALAPPDATA/screenpipe - Development/screenpipe.exe"
{{- else if .isMacOS }}
SCREENPIPE_PATH="/Applications/screenpipe.app/Contents/MacOS/screenpipe"
{{- else }}
SCREENPIPE_PATH="$HOME/.local/bin/screenpipe"
{{- end }}

# Rest of script...
`

## RECOMMENDED WORKFLOW:

1. Keep the adaptive bash script as-is (it already handles OS detection)
2. Use chezmoi to template ONLY the configuration values (FPS, capture mode)
3. Let the script handle monitor detection and OS-specific paths

This gives you:
- Maximum portability
- Minimal maintenance
- Easy to update settings via .chezmoi.toml

set -g prefix C-s
unbind C-b                    # Remove backup prefix (fixes freezing!)
bind a send-prefix            # Ctrl-s + a sends literal Ctrl-s (like screen)

# Fix terminal responsiveness and WezTerm integration
set -sg escape-time 10        # Make Escape instant in Neovim (was 500ms)
set -g focus-events on        # Better WezTerm/terminal integration
set -g assume-paste-time 1    # Prevent garbled key sequences over SSH

if "test ! -d ~/.config/tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.config/tmux/plugins/tpm && ~/.config/tmux/plugins/tpm/bin/install_plugins'"

unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display-message "‚öôÔ∏è  Config reloaded"

# Lock mode (like zellij) - disables all tmux keys except unlock
# Using Ctrl-s + Enter (not L, which is taken by pain-control)
bind Enter \
  set prefix None \;\
  set key-table locked \;\
  set -g status-style "bg=#e74c3c,fg=#ffffff,bold" \;\
  set -g status-left "üîí LOCKED " \;\
  set -g status-right " Press Ctrl-g to unlock üîí" \;\
  set -g status-justify centre \;\
  refresh-client -S \;\
  display-message "üîí LOCKED - Press Ctrl-g to unlock"

bind -T locked C-g \
  set -u prefix \;\
  set -u key-table \;\
  set -ug status-style \;\
  set -ug status-left \;\
  set -ug status-right \;\
  set -ug status-justify \;\
  refresh-client -S \;\
  display-message "üîì UNLOCKED"

# Passthrough mode - next key sent literally (more useful than locked mode)
bind Escape switch-client -T passthrough
bind -T passthrough Escape send-keys Escape

# Command palette (tmux-fzf)
TMUX_FZF_LAUNCH_KEY="C-f"                # Ctrl-s + Ctrl-f opens palette
set -g @tmux-fzf-launch-key "C-f"
bind-key "f" run-shell -b "~/.config/tmux/plugins/tmux-fzf/scripts/session.sh switch"  # Quick session switch

# Keybinding hints (tmux-which-key)
set -g @which-key-delay 1000             # Show hints after 1s
bind-key "?" run-shell "~/.config/tmux/plugins/tmux-which-key/tmux-which-key.sh"  # Manual trigger

# Visual indicators for common states
set -g window-status-activity-style "fg=#f9e2af,bg=#45475a"  # Highlight windows with activity
set -g monitor-activity on              # Monitor window activity
set -g visual-activity off               # Don't show messages, just highlight

set -s set-clipboard on
set -g allow-passthrough on

setw -g mode-keys vi

unbind-key -T copy-mode-vi v
bind-key -T copy-mode-vi 'v' send -X begin-selection
bind-key -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind-key -T copy-mode-vi 'C-q' send -X rectangle-toggle
bind-key -T copy-mode-vi 'y' send -X copy-selection


#bind-key h select-pane -L
#bind-key j select-pane -D
#bind-key k select-pane -U
#bind-key l select-pane -R
#
#bind-key C-H select-window -p
#bind-key C-L select-window -n


# List of plugins

source-file ~/.config/tmux/tmux.conf.plugins

source-file ~/.config/tmux/tmux.conf.nvim

set -g default-terminal "tmux-256color"
set -agsw terminal-overrides ",xterm-256color:RGB"
set -ag terminal-overrides ",screen-256color:RGB"

unbind [
bind [ run-shell "~/.config/tmux/scripts/copy_mode_with_line_numbers.sh"
bind 'v' run-shell "~/.config/tmux/scripts/copy_mode_with_line_numbers.sh"

# Plugin installation options
# Default TPM bindings (BLOCKS tmux, but shows progress):
#   Ctrl-s + I = install
#   Ctrl-s + U = update
#   Ctrl-s + alt-u = uninstall

# Alternative: Truly async (run in background, notification when done, NO progress bar)
# Uncomment these if you prefer async over seeing progress:
# bind I run-shell -b "~/.config/tmux/plugins/tpm/bindings/install_plugins && tmux display-message '‚úÖ Plugins installed!'"
# bind U run-shell -b "~/.config/tmux/plugins/tpm/bindings/update_plugins && tmux display-message '‚úÖ Plugins updated!'"

# Or: Run in a detached split (best of both: async + visible)
# bind I split-window -vf "~/.config/tmux/plugins/tpm/bindings/install_plugins; read -p 'Press enter to close'"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.config/tmux/plugins/tpm/tpm'


